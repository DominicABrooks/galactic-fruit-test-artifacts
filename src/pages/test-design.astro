---
import MainLayout from "../layouts/MainLayout.astro";
---

<MainLayout title="Test Design" currentPath="/test-design">
    <div class="space-y-8 text-eoe-muted max-w-5xl mx-auto">
        <!-- Header -->
        <div class="bg-eoe-panel border border-white/5 rounded-xl p-8">
            <h1 class="text-3xl font-bold text-white mb-2">Test Design</h1>
            <p class="text-lg text-eoe-muted">
                Detailed test cases and data design for Galactic Fruit.
            </p>
        </div>

        <!-- 1. Functional Test Cases -->
        <section>
        <h2 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
            <span class="bg-eoe-accent/10 text-eoe-accent w-8 h-8 rounded flex items-center justify-center text-sm">1</span>
            Functional Test Cases
        </h2>
        <div class="bg-eoe-panel border border-white/5 rounded-xl overflow-hidden">
            <div class="overflow-x-auto">
            <table class="w-full text-left text-sm whitespace-nowrap">
                <thead class="bg-white/5 text-xs uppercase text-white">
                <tr>
                    <th class="px-6 py-4">Test Condition</th>
                    <th class="px-6 py-4">Test Case ID</th>
                </tr>
                </thead>
                <tbody id="test-cases-body" class="divide-y divide-white/5">
                <!-- Rows injected here -->
                </tbody>
            </table>
            </div>
        </div>
        </section>

        <script>
        document.addEventListener("DOMContentLoaded", async () => {
            try {
            const response = await fetch(`${import.meta.env.BASE_URL}/src/data/test-analysis.json`);
            if (!response.ok) throw new Error(`Failed to load JSON: ${response.status}`);
            const data = await response.json();

            const tbody = document.getElementById("test-cases-body");

            data.testConditions.forEach(condition => {
                if (condition.linkedTestCases && condition.linkedTestCases.length > 0) {
                condition.linkedTestCases.forEach(tcId => {
                    const row = document.createElement("tr");
                    row.className = "hover:bg-white/[0.02]";

                    const tdCondition = document.createElement("td");
                    tdCondition.className = "px-6 py-4 font-mono text-eoe-accent";
                    tdCondition.textContent = condition.condition;

                    const tdTestCase = document.createElement("td");
                    tdTestCase.className = "px-6 py-4";
                    const link = document.createElement("a");
                    link.href = `/test-cases/${tcId}`;
                    link.textContent = tcId;
                    link.className = "text-purple-300 hover:underline";
                    tdTestCase.appendChild(link);

                    row.appendChild(tdCondition);
                    row.appendChild(tdTestCase);

                    tbody.appendChild(row);
                });
                }
            });
            } catch (err) {
            console.error(err);
            const tbody = document.getElementById("test-cases-body");
            tbody.innerHTML = `<tr><td colspan="2" class="px-6 py-4 italic text-xs">Failed to load test cases</td></tr>`;
            }
        });
        </script>


        <!-- 2. Test Case Design (EP/BVA) -->
        <section>
            <h2
                class="text-xl font-semibold text-white mb-4 flex items-center gap-2"
            >
                <span
                    class="bg-eoe-accent/10 text-eoe-accent w-8 h-8 rounded flex items-center justify-center text-sm"
                    >2</span
                >
                Test Case Design (EP/BVA)
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-eoe-panel border border-white/5 rounded-xl p-6">
                    <h3 class="text-white font-medium mb-4">
                        Equivalence Partitioning (Email Field)
                    </h3>
                    <ul class="space-y-3 text-sm">
                        <li
                            class="flex justify-between border-b border-white/5 pb-2"
                        >
                            <span>Valid Email</span>
                            <span class="font-mono text-green-400"
                                >user@domain.com</span
                            >
                        </li>
                        <li
                            class="flex justify-between border-b border-white/5 pb-2"
                        >
                            <span>Missing @</span>
                            <span class="font-mono text-red-400"
                                >userdomain.com</span
                            >
                        </li>
                        <li
                            class="flex justify-between border-b border-white/5 pb-2"
                        >
                            <span>Missing Domain</span>
                            <span class="font-mono text-red-400">user@</span>
                        </li>
                        <li class="flex justify-between">
                            <span>Empty String</span>
                            <span class="font-mono text-red-400">""</span>
                        </li>
                    </ul>
                </div>
                <div class="bg-eoe-panel border border-white/5 rounded-xl p-6">
                    <h3 class="text-white font-medium mb-4">
                        Boundary Value Analysis (Password Length)
                    </h3>
                    <p class="text-xs text-eoe-muted mb-4">
                        Requirement: Password must be 8-20 characters.
                    </p>
                    <ul class="space-y-3 text-sm">
                        <li
                            class="flex justify-between border-b border-white/5 pb-2"
                        >
                            <span>7 chars (Invalid)</span>
                            <span class="font-mono text-red-400">Pass123</span>
                        </li>
                        <li
                            class="flex justify-between border-b border-white/5 pb-2"
                        >
                            <span>8 chars (Valid)</span>
                            <span class="font-mono text-green-400"
                                >Pass1234</span
                            >
                        </li>
                        <li
                            class="flex justify-between border-b border-white/5 pb-2"
                        >
                            <span>20 chars (Valid)</span>
                            <span class="font-mono text-green-400"
                                >P@ssword123456789012</span
                            >
                        </li>
                        <li class="flex justify-between">
                            <span>21 chars (Invalid)</span>
                            <span class="font-mono text-red-400"
                                >P@ssword1234567890123</span
                            >
                        </li>
                    </ul>
                </div>
            </div>
        </section>
    </div>
</MainLayout>

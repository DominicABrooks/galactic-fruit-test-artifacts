---
const navItems = [
    { name: "Test Planning", path: "/test-planning" },
    { name: "Test Analysis", path: "/test-analysis" },
    { name: "Test Design", path: "/test-design" },
    { name: "Test Implementation", path: "/test-implementation" },
    { name: "Test Execution", path: "/test-execution" },
    { name: "Test Monitoring & Control", path: "/test-monitoring-control" },
    { name: "Test Closure", path: "/test-closure" },
];

const { currentPath } = Astro.props;
// Build URLs that respect `astro.config.mjs` `base` value.
const BASE = import.meta.env.BASE_URL || '/';
const BASE_SLASH = BASE.endsWith('/') ? BASE : BASE + '/';
const makePath = (p: string) => `${BASE_SLASH}${p.replace(/^\//, '')}`;
// Normalize currentPath so it can be compared to item.path regardless of `base`.
const rawCurrent = Astro.props?.currentPath || '';
// Remove BASE prefix (if present) and ensure leading slash and no trailing slash.
const normalize = (p: string) => {
    if (!p) return '';
    let s = p;
    const baseNoSlash = BASE.replace(/\/$/, '');
    // If s begins with the base (with or without trailing slash), strip it
    if (baseNoSlash !== '/' && baseNoSlash !== '' && s.startsWith(baseNoSlash)) {
        s = s.slice(baseNoSlash.length);
    } else if (BASE !== '/' && s.startsWith(BASE)) {
        s = s.slice(BASE.length);
    }
    if (!s.startsWith('/')) s = '/' + s;
    if (s !== '/') s = s.replace(/\/$/, '');
    return s;
};
const normalizedCurrent = normalize(rawCurrent as string);
---

<aside
    class="w-64 h-screen bg-eoe-panel border-r border-white/5 fixed left-0 top-0 overflow-y-auto z-50 hidden md:block"
>
    <div class="p-6">
        <h1 class="text-xl font-bold tracking-tight text-white mb-2">
            Galactic Fruit
        </h1>
        <p class="text-xs text-eoe-muted uppercase tracking-wider mb-8">
            Test Artifacts
        </p>

        <nav class="space-y-1">
            {
                navItems.map((item) => (
                    <a
                        href={makePath(item.path)}
                        class:list={[
                            "block px-4 py-3 rounded-lg text-sm font-medium transition-all duration-200",
                            normalizedCurrent === item.path
                                ? "bg-eoe-accent/10 text-eoe-accent border border-eoe-accent/20 shadow-[0_0_15px_rgba(59,130,246,0.1)]"
                                : "text-eoe-muted hover:text-white hover:bg-white/5",
                        ]}
                    >
                        {item.name}
                    </a>
                ))
            }
        </nav>
    </div>

    <div class="absolute bottom-0 left-0 w-full p-6 border-t border-white/5">
        <div class="flex items-center gap-3">
            <div
                class="w-8 h-8 rounded-full bg-gradient-to-br from-eoe-accent to-purple-600"
            >
            </div>
            <div>
                <p class="text-sm font-medium text-white">QA Team</p>
                <p class="text-xs text-eoe-muted">v1.0.0</p>
            </div>
        </div>
    </div>
</aside>
